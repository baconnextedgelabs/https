<video id="selfView" width="320" height="240" autoplay muted></video>

<button id="call">Call</button>

<video id="remoteView" width="320" height="240" autoplay muted></video>

<script src="lib/peerjs.min.js"></script>
<script>
    var selfView = document.querySelector("#selfView");
    var remoteView = document.querySelector("#remoteView");
    var localStream,
        peer,
        remoteId = 'AAAAbaconAAAA';

    navigator.getUserMedia({
        video: true,
        audio: false
    }, function (localStream) {
        selfView.srcObject = localStream;

        var call = peer.call(remoteId, localStream);
        call.on('stream', function (remoteStream) {
            remoteView.srcObject = remoteStream;
        });
    }, function (err) {
        console.log('error', err);
    });

    peer = new Peer();

    peer.on('open', function (id) {
        var connection = peer.connect(remoteId);
        console.log('ID', id);

        connection.on('open', function () {
            // connection.send('test');
        });

        connection.on('data', function (message) {
            console.log('connection data', message);
        });

        connection.on('err', function (err) {
            console.log('connection err', err);
        });

        connection.on('close', function () {
            console.log('connection close');
        });
    });


    peer.on('connection', function (conn) {
        console.log('peer connection', conn);
    });
    peer.on('error', function (err) {
        console.log('peer err', err);
    });
</script>
